---
title: iTop实施杂记
author:          # 作者（数组）
  - An He
date: \today     # 日期
copyright: true  # 是否生成版权页
lof: true        # 是否生成插图列表页
lot: true        # 是否生成表格列表页
homepage: https://github.com/annProg/itop-book
publisher: pandoc-template       # epub用
rights: © 2017 An He, CC BY-NC   # epub用
# preface用于生成前言
preface: '从事运维工作已经3年多，所见所闻，切身感受，当运维的规模大到一定程度的时候，
 资源的管控将变得很重要，主要体现在效率和成本两个方面。
 
 
 举例来说，我接手了一个URL监控的工作，具体流程是：研发人员写一个监控配置文件提交到
 代码库，然后发邮件通知我，我执行一个脚本将监控加入Zabbix。当规模很小的时候不会有
 什么问题，即使完全手动来配置都可以，我也能记住
 所有的URL。一旦规模大到一定程度，比如说50个，我记不住了，或者每周每月都有几十的增减，
 需要经常投入时间去执行脚本，研发人员配置文件写错的时候还要来回邮件沟通。这个
 时候有一个合理的管控手段就非常重要了。要有一个系统来记录URL的监控信息以及状态，同步
 给监控系统，并且URL的增删改应该由研发自助完成，无需运维人肉参与，这样一来，监控变
 更速度（效率）提升了，运维也不用做这个重复的工作了。人力成本，沟通成本相应就下降了。
 
 
 一个反例，我第二份工作，公司层面没有一个有效全面的资源管控的技术手段，没有全
 公司统一的业务线口径。服务器、
 数据库、域名、缓存等资源一般只能管理到部门粒度，就是说一个部门指定几个接口人，
 有事都找他们。这样的设计是很糟糕的，资源提供方把本该自己牢牢掌控的资源
 管理权下放给了各个部门，导致自己无法掌握资源的关联及使用情况，业务部门受限于人力
 或者技术，也常常不能有效的管控资源，常常是业务早下线了，数据库还长期占用着资源。
 在公司经历
 危机之后，拖欠了好几个机房的费用，这时开始大张旗鼓手忙脚乱的回收闲置资源或者关闭机房，
 统计资源的手段用的却是Excel表格、编辑wiki页面等形式。这种混乱带来的不仅仅是效率
 低下，还有高昂的运维成本以及负反馈带来的恶性循环：资源无法得到有效的管控，不能及时回收，
 需要不断的购入新的服务器资源，最终成本只会越来越高。
 
 
 我认为正确的方向
 应该是用技术手段来减小资源管理的粒度，统一业务线名称，并用一个系统去搞清楚
 资源关联关系，而不是Excel
 表格。具体来说，业务要挂在具体的人名下，而资源要挂在业务下面，而不是某个人名下，
 这样就能容易的做到业务下线，相关资源一并下线。还带来一个额外的好处，人员离职只
 需要交接业务，因为资源关联的是业务而不是人，就不会出现人员离职找不到联系人的问题。
 这样不仅仅是减少了钱的支出，也提高了沟通的效率。
 只要粒度够细，关联关系够清晰，很多事情都会迎刃而解，比如报警，有这样一个CI关联
 数据库就不愁报警发给谁了，就不用去人肉维护Zabbix动作以及用户了。
 
 
 针对以上问题，我希望引入CMDB系统来解决。调研过几个开源的CMDB系统，包括yourcmdb，i-doit等。
 最终选择了文档功能都较为
 完善，开发也较为活跃的iTop作为CMDB工具进行定制，管理资源的关联关系，
 实现业务联系人查询接口供报警调用，避免用
 zabbix维护报警联系人；定制iTop权限让研发人员可以编辑自己负责的APP，相当于自助订阅报警；
 将iTop作为URL监控配置的前端表单，实现研发自助添加URL监控；
 定制工单系统，自动指派工单，自动录入新申请资源。
 实际效果是我部门的资源管理情况得到改善。由于没有机会在整个公司层面实施，有些观点可能
 并不全面。另外，我对ITIL理论并不熟悉，因此不打算从理论
 上探讨CMDB，只从iTop的实施经历，谈谈iTop CMDB的定制与运维自动化的一些经验。

 
 计划安排以下内容：iTop简介，iTop插件开发流程，常用插件介绍；然后通过几个案例说明iTop对
 运维效率提升机成本优化的帮助，包含一致性维护，工单流程，标准化，CI关联关系，公共查询接口等主题。
 
 
 **第一章**  简单介绍一下iTop，iTop的插件开发流程，CI定制，本地化等等
 **第二章**  CI属性约束，唯一性、profile权限，只读，隐藏等等
 **第三章**  SSO集成方法
 **第四章**  
 
 iTop简介
 iTop插件开发流程
 CI定制（删除、新增、修改）
 menunode定制
 本地化
 CI属性约束（唯一性，只读，隐藏）
 SSO集成方法
 action-shell-exec
 trigger
 CI生命周期（lifecycle)
 cmdbapi
 rest扩展
 api-client
 request-template，工单自动指派，资源自动入库
 custom-pages
 iframe嵌入
 AttributeClassCustom
 其他常用插件介绍
 审计
 Profile，自助化与权限控制
 实例（URL监控）
 
 api相关的可以放在系统集成部分
 
 '
---